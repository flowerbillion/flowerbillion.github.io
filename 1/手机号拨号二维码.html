<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>ğŸ“± æ‰‹æœºå·æ‹¨å·äºŒç»´ç </title>
    <!-- ä½¿ç”¨ QRCode åº“ (è½»é‡, æ”¯æŒ canvas) -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
        }

        body {
            background: linear-gradient(145deg, #e9eef2 0%, #dfe4e8 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }

        /* ä¸»å¡ç‰‡ â€” å±‚æ¬¡æ„Ÿä¸æŸ”å’Œé˜´å½± */
        .card {
            max-width: 520px;
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(4px);
            background: #ffffff;
            border-radius: 36px;
            box-shadow: 0 25px 45px -12px rgba(0, 20, 30, 0.25),
                        0 10px 20px -8px rgba(0, 0, 0, 0.15),
                        inset 0 1px 2px rgba(255,255,255,0.6);
            padding: 2rem 1.8rem;
            transition: all 0.2s ease;
            border: 1px solid rgba(255,255,255,0.5);
        }

        /* æ ‡é¢˜åŒº */
        .app-header {
            margin-bottom: 1.5rem;
            text-align: left;
        }
        .app-header h1 {
            font-size: 1.9rem;
            font-weight: 650;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, #1f2b3a, #2c3e50);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .app-header h1 span {
            font-size: 2rem;
        }
        .subhead {
            font-size: 1rem;
            color: #4b5f73;
            background: #f0f4fa;
            padding: 0.6rem 1rem;
            border-radius: 60px;
            display: inline-block;
            font-weight: 450;
            box-shadow: inset 0 1px 4px rgba(0,0,0,0.02);
        }

        /* ç”Ÿæˆå™¨åŒºå— (é»˜è®¤æ˜¾ç¤º) */
        .generator-section {
            transition: opacity 0.2s;
        }

        /* è¾“å…¥æ¡†ä¸æ ‡ç­¾ */
        .input-field {
            margin: 1.8rem 0 1rem;
        }
        .input-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 550;
            color: #1e2b3a;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        .input-label i {
            font-size: 1.2rem;
            color: #0077be;
        }
        .phone-input-wrapper {
            display: flex;
            align-items: center;
            background: #f2f6fc;
            border-radius: 22px;
            border: 1.5px solid #d9e2ec;
            transition: 0.15s;
            padding: 0 6px 0 18px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.02);
        }
        .phone-input-wrapper:focus-within {
            border-color: #2b7fc2;
            box-shadow: 0 0 0 4px rgba(0,112,243,0.15);
        }
        .phone-input-wrapper input {
            width: 100%;
            border: none;
            background: transparent;
            padding: 16px 12px 16px 0;
            font-size: 1.2rem;
            font-weight: 500;
            letter-spacing: 0.5px;
            outline: none;
            color: #0b1c2b;
        }
        .phone-input-wrapper input::placeholder {
            color: #9aafc4;
            font-weight: 400;
            font-size: 1rem;
            letter-spacing: normal;
        }
        .prefix-icon {
            font-size: 1.3rem;
            color: #56789a;
            margin-right: 6px;
        }

        /* åŒæŒ‰é’®ç»„ */
        .action-row {
            display: flex;
            gap: 12px;
            margin: 20px 0 22px;
        }
        .btn {
            flex: 1;
            border: none;
            padding: 16px 8px;
            border-radius: 40px;
            font-weight: 650;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            background: white;
            box-shadow: 0 5px 12px rgba(0,20,40,0.08);
        }
        .btn-primary {
            background: #1e2f40;
            color: white;
            border: 1px solid #14232e;
        }
        .btn-primary:hover {
            background: #2b4055;
            transform: scale(1.01);
            box-shadow: 0 10px 20px -8px #10212e;
        }
        .btn-secondary {
            background: #ffffff;
            color: #1f3a4b;
            border: 1px solid #bccfdf;
        }
        .btn-secondary:hover {
            background: #ecf3fa;
            border-color: #8faec9;
        }

        /* äºŒç»´ç å±•ç¤ºåŒº */
        .qr-preview {
            background: #ffffff;
            padding: 1.2rem;
            border-radius: 32px;
            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05), 0 15px 25px -12px rgba(34, 47, 62, 0.2);
            margin: 1.5rem 0 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .qr-canvas-container {
            background: #fcfcfc;
            padding: 12px;
            border-radius: 28px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }
        canvas {
            display: block;
            width: 200px;
            height: 200px;
            margin: 0 auto;
            border-radius: 20px;
            background: #ffffff;
        }
        .qr-hint {
            margin-top: 12px;
            font-size: 0.9rem;
            color: #3e5d77;
            background: #e6f0f9;
            padding: 10px 18px;
            border-radius: 60px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .error-message {
            color: #c3353a;
            font-size: 0.9rem;
            margin: 6px 0 0 10px;
            font-weight: 500;
            background: #ffe8e8;
            padding: 6px 16px;
            border-radius: 40px;
            display: inline-block;
        }

        /* ä½¿ç”¨è¯´æ˜å¡ç‰‡ */
        .instruction-card {
            background: #f0f6fd;
            border-radius: 30px;
            padding: 1.5rem 1.6rem;
            margin-top: 1.8rem;
            border: 1px solid rgba(148, 184, 218, 0.3);
            box-shadow: 0 8px 16px -12px #4a6680;
        }
        .instruction-card h3 {
            font-size: 1.25rem;
            color: #1b3b4f;
            margin-bottom: 1rem;
            font-weight: 620;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .instruction-list {
            list-style: none;
        }
        .instruction-list li {
            margin-bottom: 14px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            color: #23475e;
            font-size: 0.98rem;
            line-height: 1.4;
        }
        .instruction-list li::before {
            content: "âœ“";
            background: #1f4b6e;
            color: white;
            font-weight: bold;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
            box-shadow: 0 4px 6px -2px #9fb8d0;
        }

        /* æ‹¨å·ç¡®è®¤ç•Œé¢ (é»˜è®¤éšè—) */
        .dialer-section {
            text-align: center;
            padding: 0.5rem 0 1rem;
        }
        .dialer-phone-number {
            font-size: 2.4rem;
            font-weight: 700;
            letter-spacing: 2px;
            background: #1e2f40;
            color: white;
            padding: 1rem 1.2rem;
            border-radius: 60px;
            margin: 1.8rem 0 1.5rem;
            box-shadow: 0 15px 20px -12px #1e3b4e;
            border: 1px solid #6387a3;
        }
        .btn-dial {
            background: #2d6a4f;
            color: white;
            border: none;
            padding: 20px 28px;
            border-radius: 60px;
            font-size: 1.6rem;
            font-weight: 650;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 24px 0 18px;
            box-shadow: 0 15px 25px -8px #1b4b3b;
            transition: all 0.15s;
            cursor: pointer;
        }
        .btn-dial:hover {
            background: #1e8b62;
            transform: scale(1.01);
        }
        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #2e5570;
            text-decoration: none;
            font-weight: 600;
            padding: 14px 24px;
            border-radius: 40px;
            background: #e2ebf3;
            border: 1px solid #b6d0e2;
        }
        .back-link:hover {
            background: #ccddec;
        }

        .hidden {
            display: none;
        }

        /* å°emoji/iconå ä½ */
        .icon {
            font-size: 1.3rem;
        }

        hr {
            border: none;
            height: 2px;
            background: linear-gradient(to right, #cbdae7, transparent);
            margin: 1rem 0;
        }
        .note-light {
            color: #4a637a;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
<div class="card" id="appCard">
    <!-- å¤´éƒ¨å…±ç”¨ -->
    <div class="app-header">
        <h1>
            <span>ğŸ“²</span> æ‹¨å·äºŒç»´ç 
        </h1>
        <div class="subhead">
            âš¡ æ‰«ç ç¡®è®¤ Â· ä¸€é”®æ‹¨å‡º
        </div>
    </div>

    <!-- ç”Ÿæˆå™¨åŒºå— (é»˜è®¤æ˜¾ç¤º) -->
    <div id="generatorSection" class="generator-section">
        <div class="input-field">
            <div class="input-label">
                <span class="icon">ğŸ“</span> è¯·è¾“å…¥11ä½æ‰‹æœºå·
            </div>
            <div class="phone-input-wrapper">
                <span class="prefix-icon">ğŸ“±</span>
                <input type="tel" id="phoneInput" placeholder="å¦‚ 13800138000" maxlength="11" inputmode="numeric" pattern="\d*">
            </div>
            <div id="errorMsg" class="error-message" style="display: none;"></div>
        </div>

        <div class="action-row">
            <button class="btn btn-primary" id="generateBtn"><span>âœ¨</span> ç”ŸæˆäºŒç»´ç </button>
            <button class="btn btn-secondary" id="resetBtn"><span>ğŸ”„</span> é‡ç½®</button>
        </div>

        <!-- äºŒç»´ç é¢„è§ˆåŒº + æç¤º -->
        <div class="qr-preview">
            <div class="qr-canvas-container" id="qrContainer">
                <canvas id="qrCanvas" width="200" height="200"></canvas>
            </div>
            <div class="qr-hint">
                <span>ğŸ“· å¾®ä¿¡æ‰«ç  â†’ ç¡®è®¤æ‹¨å·</span>
            </div>
            <!-- åŠ¨æ€å¸®åŠ©æ–‡å­— (å ä½) -->
            <div style="font-size:0.85rem; color:#597a9b; margin-top:8px;">æ‰«ç åè¿›å…¥ç¡®è®¤é¡µé¢ï¼Œç‚¹å‡»å³å¯å‘¼å«</div>
        </div>

        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="instruction-card">
            <h3><span>ğŸ“‹</span> ä½¿ç”¨è¯´æ˜</h3>
            <ul class="instruction-list">
                <li>è¾“å…¥11ä½æœ‰æ•ˆæ‰‹æœºå·ï¼Œç‚¹å‡»ã€Œç”ŸæˆäºŒç»´ç ã€</li>
                <li>å¾®ä¿¡æ‰«ç åä¼šè¿›å…¥æ‹¨å·ç¡®è®¤é¡µé¢</li>
                <li>ç‚¹å‡»ã€Œç¡®è®¤æ‹¨å·ã€æŒ‰é’®ï¼Œç³»ç»Ÿæç¤ºæ˜¯å¦æ‹¨æ‰“</li>
                <li>ç¡®è®¤åå°†ç›´æ¥è·³è½¬åˆ°æ‰‹æœºæ‹¨å·ç•Œé¢</li>
            </ul>
            <hr>
            <div class="note-light">ğŸ”” æ‰‹æœºæµ‹è¯•è¯·ç¡®ä¿ç”µè„‘/æ‰‹æœºåŒä¸€ç½‘ç»œï¼Œé€šè¿‡IPè®¿é—®æœ¬é¡µé¢</div>
        </div>
    </div>

    <!-- æ‹¨å·ç¡®è®¤åŒºå— (é»˜è®¤éšè—) -->
    <div id="dialerSection" class="dialer-section hidden">
        <div style="font-size:1.5rem; font-weight:550; color:#204156;">ğŸ“ æ‹¨å·ç¡®è®¤</div>
        <div class="dialer-phone-number" id="dialerPhoneDisplay"></div>
        <button class="btn-dial" id="confirmDialBtn">
            <span>ğŸ“²</span> ç¡®è®¤æ‹¨å·
        </button>
      
        <div style="margin-top:25px; color:#456f8c;">å¾®ä¿¡æ‰«ç åç‚¹å‡»ã€Œç¡®è®¤ã€å³å¯å”¤èµ·ç³»ç»Ÿæ‹¨å·</div>
    </div>
</div>

<script>
    (function() {
        // ---------- DOM å…ƒç´  ----------
        const generatorSection = document.getElementById('generatorSection');
        const dialerSection = document.getElementById('dialerSection');
        const phoneInput = document.getElementById('phoneInput');
        const generateBtn = document.getElementById('generateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const errorMsg = document.getElementById('errorMsg');
        const qrCanvas = document.getElementById('qrCanvas');
        const dialerPhoneDisplay = document.getElementById('dialerPhoneDisplay');
        const confirmDialBtn = document.getElementById('confirmDialBtn');
        const backLink = document.getElementById('backToGeneratorLink');

        // å½“å‰é¡µé¢åŸºç¡€ URL (å»é™¤å‚æ•°ï¼Œç”¨äºç”ŸæˆäºŒç»´ç )
        function getBaseUrl() {
            return window.location.protocol + '//' + window.location.host + window.location.pathname;
        }

        // è¾…åŠ©å‡½æ•°ï¼šæ ¡éªŒæ‰‹æœºå· (11ä½æ•°å­—)
        function isValidPhone(phone) {
            return /^\d{11}$/.test(phone);  // çº¯11ä½æ•°å­— (å¯æ ¹æ®éœ€æ±‚æ”¶ç´§ä¸º1å¼€å¤´çš„å·æ®µï¼Œä½†æ­¤å¤„ä»…åšç¤ºä¾‹)
        }

        // æ¸…ç©ºç”»å¸ƒä¸ºæµ…ç°è‰²å ä½ (ç¾è§‚)
        function clearCanvasToPlaceholder() {
            const ctx = qrCanvas.getContext('2d');
            ctx.fillStyle = '#f0f4fa';
            ctx.fillRect(0, 0, qrCanvas.width, qrCanvas.height);
            // å¢åŠ ä¸€ç‚¹ç½‘æ ¼çº¿è£…é¥° (å¯é€‰)
            ctx.fillStyle = '#d4dee9';
            ctx.font = '12px system-ui';
            ctx.fillText('äºŒç»´ç ', 70, 110);
        }

        // é‡ç½®ç”Ÿæˆå™¨ç•Œé¢ (æ¸…ç©ºè¾“å…¥ã€é”™è¯¯ã€ç”»å¸ƒå ä½)
        function resetGeneratorUI() {
            phoneInput.value = '';
            errorMsg.style.display = 'none';
            errorMsg.innerText = '';
            clearCanvasToPlaceholder();
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(text) {
            errorMsg.innerText = text;
            errorMsg.style.display = 'inline-block';
        }

        // ç”ŸæˆäºŒç»´ç  (åŸºäºphone)
        function generateQRFromPhone(phone) {
            if (!isValidPhone(phone)) {
                showError('è¯·è¾“å…¥11ä½æœ‰æ•ˆæ‰‹æœºå· (ä»…æ•°å­—)');
                clearCanvasToPlaceholder();
                return false;
            }

            // æ„å»ºç›®æ ‡URL: å½“å‰é¡µé¢å®Œæ•´è·¯å¾„ + ?phone=XXX
            const targetUrl = getBaseUrl() + '?phone=' + encodeURIComponent(phone);
            // è°ƒç”¨QRCodeåº“ç»˜åˆ¶canvas
            QRCode.toCanvas(qrCanvas, targetUrl, { 
                width: 200,
                margin: 1,
                color: { dark: '#1e2f40', light: '#ffffff' } // æ·±è‰²äºŒç»´ç 
            }, function (error) {
                if (error) {
                    console.error('äºŒç»´ç ç”Ÿæˆå¤±è´¥', error);
                    showError('äºŒç»´ç ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•');
                    clearCanvasToPlaceholder();
                } else {
                    // æˆåŠŸï¼šéšè—é”™è¯¯
                    errorMsg.style.display = 'none';
                }
            });
            return true;
        }

        // é‡ç½®æŒ‰é’®
        resetBtn.addEventListener('click', function() {
            resetGeneratorUI();
        });

        // ç”ŸæˆæŒ‰é’®
        generateBtn.addEventListener('click', function() {
            const phone = phoneInput.value.trim();
            if (!phone) {
                showError('è¯·è¾“å…¥æ‰‹æœºå·');
                clearCanvasToPlaceholder();
                return;
            }
            generateQRFromPhone(phone);
        });

        // è¾“å…¥æ¡†æ”¯æŒå›è½¦ç”Ÿæˆ
        phoneInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                generateBtn.click();
            }
        });

        // ---------- é¡µé¢åŠ è½½æ—¶æ ¹æ®å‚æ•°åˆ‡æ¢ç•Œé¢ ----------
        function initViewFromURL() {
            const params = new URLSearchParams(window.location.search);
            const phoneParam = params.get('phone');

            // æ— å‚æ•°: æ˜¾ç¤ºç”Ÿæˆå™¨ï¼Œé‡ç½®ç”»å¸ƒå ä½
            if (!phoneParam) {
                generatorSection.classList.remove('hidden');
                dialerSection.classList.add('hidden');
                resetGeneratorUI();  // æ¸…ç©ºè¾“å…¥/ç”»å ä½
                return;
            }

            // æœ‰å‚æ•°: æ ¡éªŒæ˜¯å¦åˆæ³•æ‰‹æœº
            const decodedPhone = phoneParam.trim();
            if (isValidPhone(decodedPhone)) {
                // æœ‰æ•ˆ: éšè—ç”Ÿæˆå™¨ï¼Œæ˜¾ç¤ºæ‹¨å·ç•Œé¢ï¼Œå¹¶è®¾ç½®å·ç 
                generatorSection.classList.add('hidden');
                dialerSection.classList.remove('hidden');
                dialerPhoneDisplay.innerText = decodedPhone;

                // ä¸ºæ‹¨å·æŒ‰é’®ç»‘å®šäº‹ä»¶ (é˜²æ­¢é‡å¤ç»‘å®š)
                confirmDialBtn.onclick = function() {
                    // å”¤èµ·ç³»ç»Ÿæ‹¨å·
                    window.location.href = 'tel:' + decodedPhone;
                };

                // è¿”å›é“¾æ¥: å›åˆ°æ— å‚æ•°é¦–é¡µ (ä¿ç•™å½“å‰path)
                backLink.href = window.location.pathname;  // å¹²å‡€é“¾æ¥
            } else {
                // æ— æ•ˆå‚æ•°ï¼šæ˜¾ç¤ºç”Ÿæˆå™¨ï¼Œå¹¶æç¤ºé”™è¯¯ï¼Œè¾“å…¥æ¡†é¢„å¡«æ— æ•ˆå†…å®¹ä½†é«˜äº®é”™è¯¯
                generatorSection.classList.remove('hidden');
                dialerSection.classList.add('hidden');
                phoneInput.value = decodedPhone;  // æ˜¾ç¤ºé”™è¯¯çš„å†…å®¹
                showError('æ— æ•ˆæ‰‹æœºå·å‚æ•°ï¼Œè¯·é‡æ–°è¾“å…¥');
                clearCanvasToPlaceholder();
            }
        }

        // åˆå§‹è°ƒç”¨
        initViewFromURL();

        // é¢å¤–ï¼šå½“é€šè¿‡è¿”å›é“¾æ¥å›åˆ°ç”Ÿæˆå™¨æ—¶ï¼Œé‡ç½®å¹²å‡€çŠ¶æ€ (ä½†é“¾æ¥å·²ç»åˆ·æ–°é¡µé¢ï¼Œä½†ä»¥é˜²onclick)
        // åŒæ—¶å¤„ç†å½“ç›´æ¥é€šè¿‡hashç­‰æƒ…å†µï¼Œä½†æ²¡å…³ç³»

        // ä¸ºäº†æ›´åŠ ç¨³å¥ï¼Œç›‘å¬popstate? ä½†æ— å¿…è¦ï¼Œé“¾æ¥åˆ·æ–°é‡æ–°åŠ è½½ã€‚

        // é˜²æ­¢ç”¨æˆ·æ‰‹åŠ¨æ¸…ç©ºå‚æ•°åï¼Œå†ç”ŸæˆäºŒç»´ç ä»ç„¶æ­£ç¡® (å·²ç»ä½¿ç”¨getBaseUrlæ— å‚æ•°)
        // è‹¥å½“å‰å·²ç»åœ¨å¸¦å‚é¡µé¢ä½†æ‹¨å·ç•Œé¢ä¸‹ï¼Œç”¨æˆ·æ— æ³•æ“ä½œç”Ÿæˆå™¨ï¼Œæ‰€ä»¥å¿½ç•¥

        // è¡¥ä¸: å¦‚æœå½“å‰åœ¨æ‹¨å·ç•Œé¢ï¼Œä½†ç‚¹å‡»æµè§ˆå™¨å›é€€ä¹‹ç±»ï¼Œå·²å¤„ç†

        // æä¾›æ‰‹åŠ¨æ¸…é™¤ç”»å¸ƒå ä½ï¼Œåˆæ¬¡åŠ è½½
        if (generatorSection.classList.contains('hidden') === false) {
            // å¦‚æœæ˜¯ç”Ÿæˆå™¨ç•Œé¢ï¼Œç¡®ä¿ç”»å¸ƒå ä½
            clearCanvasToPlaceholder();
        }

        // å¤„ç†æ‰‹æœºå·è¾“å…¥é™åˆ¶ (åªå…è®¸æ•°å­—)
        phoneInput.addEventListener('input', function(e) {
            this.value = this.value.replace(/[^\d]/g, '').slice(0, 11);
        });
    })();
</script>
<!-- é¢å¤–å°ä¼˜åŒ–ï¼šé˜²æ­¢æ‹¨å·æŒ‰é’®åœ¨pcä¸Šæ— åé¦ˆï¼Œå¢åŠ æç¤º (ä¸å½±å“åŠŸèƒ½) -->
</body>
</html>